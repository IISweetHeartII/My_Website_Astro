---
import { Share2 } from "lucide-astro";

interface Props {
  title: string;
  url: string;
  description: string;
}

const { title, url } = Astro.props;

const encodedTitle = encodeURIComponent(title);
const encodedUrl = encodeURIComponent(url);

const shareLinks = [
  {
    name: "X",
    href: `https://twitter.com/intent/tweet?text=${encodedTitle}&url=${encodedUrl}`,
    label: "X에 공유",
    icon: "x",
  },
  {
    name: "LinkedIn",
    href: `https://www.linkedin.com/sharing/share-offsite/?url=${encodedUrl}`,
    label: "LinkedIn에 공유",
    icon: "linkedin",
  },
  {
    name: "카카오스토리",
    href: `https://story.kakao.com/share?url=${encodedUrl}`,
    label: "카카오스토리에 공유",
    icon: "kakao",
  },
];
---

<section class="social-share mt-12 pt-8 border-t border-background-lighter">
  <h2 class="flex items-center justify-center gap-2 text-2xl font-bold text-text mb-6">
    <Share2 class="w-5 h-5" />
    공유하기
  </h2>
  <div class="flex items-center justify-center gap-3">
    {shareLinks.map((link) => (
      <a
        href={link.href}
        target="_blank"
        rel="noopener noreferrer"
        class="group relative inline-flex items-center justify-center w-11 h-11 rounded-full border border-background-lighter bg-background-light hover:border-primary hover:bg-primary/10 transition-all duration-200 no-underline"
        title={link.label}
      >
        {link.icon === "x" && (
          <svg class="w-4 h-4 text-text group-hover:text-primary" viewBox="0 0 24 24" fill="currentColor">
            <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z" />
          </svg>
        )}
        {link.icon === "linkedin" && (
          <svg class="w-4 h-4 text-text group-hover:text-primary" viewBox="0 0 24 24" fill="currentColor">
            <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 01-2.063-2.065 2.064 2.064 0 112.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z" />
          </svg>
        )}
        {link.icon === "kakao" && (
          <svg class="w-4 h-4 text-text group-hover:text-primary" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 3c5.799 0 10.5 3.664 10.5 8.185 0 4.52-4.701 8.184-10.5 8.184a13.5 13.5 0 01-1.727-.11l-4.408 2.883c-.501.265-.678.236-.472-.413l.892-3.678c-2.88-1.46-4.785-3.99-4.785-6.866C1.5 6.664 6.201 3 12 3z" />
          </svg>
        )}
        <span class="absolute -top-9 left-1/2 -translate-x-1/2 px-2 py-1 text-xs rounded bg-text text-background opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap pointer-events-none">
          {link.label}
        </span>
      </a>
    ))}
    <button
      type="button"
      class="copy-url-btn group relative inline-flex items-center justify-center w-11 h-11 rounded-full border border-background-lighter bg-background-light hover:border-primary hover:bg-primary/10 transition-all duration-200"
      title="링크 복사"
      data-url={url}
    >
      <svg class="w-4 h-4 text-text group-hover:text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1" />
      </svg>
      <span class="absolute -top-9 left-1/2 -translate-x-1/2 px-2 py-1 text-xs rounded bg-text text-background opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap pointer-events-none">
        링크 복사
      </span>
    </button>
  </div>
  {/* Toast notification */}
  <div class="copy-toast fixed bottom-6 left-1/2 -translate-x-1/2 px-4 py-2 rounded-lg bg-primary text-on-primary text-sm font-medium shadow-lg opacity-0 transition-opacity duration-300 pointer-events-none z-50">
    링크가 복사되었습니다!
  </div>
</section>

<script>
  document.addEventListener("astro:page-load", () => {
    const btn = document.querySelector<HTMLButtonElement>(".copy-url-btn");
    const toast = document.querySelector<HTMLElement>(".copy-toast");
    if (!btn || !toast) return;

    btn.addEventListener("click", async () => {
      const url = btn.dataset["url"];
      if (!url) return;
      try {
        await navigator.clipboard.writeText(url);
        toast.style.opacity = "1";
        setTimeout(() => { toast.style.opacity = "0"; }, 2000);
      } catch {
        // Fallback for older browsers
        const input = document.createElement("input");
        input.value = url;
        document.body.appendChild(input);
        input.select();
        document.execCommand("copy");
        document.body.removeChild(input);
        toast.style.opacity = "1";
        setTimeout(() => { toast.style.opacity = "0"; }, 2000);
      }
    });
  });
</script>
