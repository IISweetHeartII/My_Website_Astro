---
import BaseHead from '../components/BaseHead.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import BlogCard from '../components/BlogCard.astro';
import { getCollection, type CollectionEntry } from 'astro:content';

// Helper function to get a valid timestamp or fallback
function getValidTimestamp(date: Date | null | undefined): number {
    if (!date) return 0;
    const timestamp = date.getTime();
    return isNaN(timestamp) ? 0 : timestamp;
}

const posts = (await getCollection('blog'))
    .filter((post: CollectionEntry<'blog'>) => post.data.publish)
    .sort((a: CollectionEntry<'blog'>, b: CollectionEntry<'blog'>) => {
        const dateA = getValidTimestamp(a.data.created_date);
        const dateB = getValidTimestamp(b.data.created_date);
        return dateB - dateA;
    });
---

<!doctype html>
<html lang="en">
    <head>
        <BaseHead title="Blog - Ideas & Insights" description="Explore our collection of articles, ideas, insights, and everything in between." />
    </head>
    <body class="min-h-screen flex flex-col m-0">
        <Header />
        <main class="flex-1 w-full max-w-screen-lg mx-auto p-8 flex flex-col">
            {posts.length > 0 ? (
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 flex-1 mb-8">
                    {posts.map((post: CollectionEntry<'blog'>) => (
                        <BlogCard
                            title={post.data.title}
                            description={post.data.description ?? undefined}
                            date={post.data.created_date ?? undefined}
                            slug={post.data.slug ?? post.id.replace(/\.[^/.]+$/, '')}
                        />
                    ))}
                </div>
            ) : (
                <div class="text-center p-16 text-gray-700 text-lg flex-1 md:p-12 md:text-base dark:text-gray-300">
                    No posts found. Check back soon!
                </div>
            )}
        </main>
        <Footer />
    </body>
</html> 