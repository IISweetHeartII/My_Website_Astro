---
import Layout from '../layouts/Layout.astro';

interface ExpertiseItem {
  id: string;
  title: string;
  description: string;
  status: string;
}

interface ActivityItem {
  id: string;
  title: string;
  description: string;
  date: string;
}

interface NowData {
  expertise: ExpertiseItem[];
  activities: ActivityItem[];
}

// APIì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜´
let nowData: NowData = { expertise: [], activities: [] };
try {
  const response = await fetch(`${Astro.url.origin}/api/now.json`);
  if (response.ok) {
    nowData = await response.json();
  }
} catch (error) {
  console.error('Failed to fetch now data:', error);
  // ê¸°ë³¸ ë°ì´í„° ì‚¬ìš©
  nowData = {
    expertise: [
      {
        id: "1",
        title: "Astro ë¸”ë¡œê·¸ í”Œë«í¼ ê°œë°œ",
        description: "Astroì™€ TailwindCSSë¥¼ í™œìš©í•œ ê°œì¸ ë¸”ë¡œê·¸ í”Œë«í¼ ê°œë°œ ë° ìµœì í™” ì‘ì—…ì„ ì§„í–‰í•˜ê³  ìˆìŠµë‹ˆë‹¤.",
        status: "ì§„í–‰ì¤‘"
      }
    ],
    activities: [
      {
        id: "1",
        title: "Showcase í˜ì´ì§€ ë¦¬ë‰´ì–¼",
        description: "í”„ë¡œì íŠ¸ ì†Œê°œ í˜ì´ì§€ë¥¼ ì‚¬ìš©ì ì¤‘ì‹¬ìœ¼ë¡œ ì™„ì „íˆ ì¬ì„¤ê³„í–ˆìŠµë‹ˆë‹¤.",
        date: "2024-12-15"
      }
    ]
  };
}

// ë””ìŠ¤í”Œë ˆì´ìš© ë°ì´í„° ë³€í™˜ (ê¸°ì¡´ ë””ìì¸ê³¼ í˜¸í™˜)
const displayData = [
  {
    id: 1,
    title: "Building the Log8 Blog",
    description: "Astroì™€ TailwindCSSë¥¼ í™œìš©í•œ ê°œì¸ ë¸”ë¡œê·¸ í”Œë«í¼ ê°œë°œ ë° ìµœì í™” ì‘ì—…ì„ ì§„í–‰í•˜ê³  ìˆìŠµë‹ˆë‹¤. ì‚¬ìš©ì ê²½í—˜ê³¼ ì„±ëŠ¥ í–¥ìƒì— ì§‘ì¤‘í•˜ê³  ìˆì–´ìš”.",
    category: "ê°œë°œ",
    icon: "ğŸš€",
    color: "from-blue-100 to-cyan-200",
    textColor: "text-blue-700",
    activities: nowData.activities.slice(0, 3).map(activity => ({
      date: new Date(activity.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric' }),
      activity: activity.description
    }))
  },
  {
    id: 2,
    title: "Exploring New AI Models",
    description: "ìµœì‹  LLMë“¤ì˜ ì•„í‚¤í…ì²˜ì™€ ì„±ëŠ¥ì„ ë¹„êµ ë¶„ì„í•˜ë©°, few-shot learningê³¼ í”„ë¡¬í”„íŠ¸ ì—”ì§€ë‹ˆì–´ë§ì— ëŒ€í•´ ê¹Šì´ ì—°êµ¬í•˜ê³  ìˆìŠµë‹ˆë‹¤.",
    category: "AI/ML",
    icon: "ğŸ¤–",
    color: "from-purple-100 to-pink-200",
    textColor: "text-purple-700",
    activities: [
      { date: "Dec 12", activity: "Claude 3.5 Sonnetê³¼ GPT-4o ì„±ëŠ¥ ë¹„êµ ì‹¤í—˜" },
      { date: "Dec 8", activity: "í”„ë¡¬í”„íŠ¸ ìµœì í™” ê¸°ë²• ì—°êµ¬ ë° ì ìš©" },
      { date: "Dec 3", activity: "Anthropicì˜ Constitutional AI ë…¼ë¬¸ ë¶„ì„" }
    ]
  },
  {
    id: 3,
    title: "Learning System Design",
    description: "ëŒ€ê·œëª¨ ì‹œìŠ¤í…œ ì„¤ê³„ì™€ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì•„í‚¤í…ì²˜ì— ëŒ€í•´ í•™ìŠµí•˜ë©°, ì‹¤ì œ í”„ë¡œì íŠ¸ì— ì ìš© ê°€ëŠ¥í•œ íŒ¨í„´ë“¤ì„ ì—°êµ¬í•˜ê³  ìˆìŠµë‹ˆë‹¤.",
    category: "ì•„í‚¤í…ì²˜",
    icon: "ğŸ—ï¸",
    color: "from-green-100 to-teal-200",
    textColor: "text-green-700",
    activities: [
      { date: "Dec 14", activity: "Redisë¥¼ í™œìš©í•œ ìºì‹± ì „ëµ ì„¤ê³„ ë° êµ¬í˜„" },
      { date: "Dec 9", activity: "ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ê°„ í†µì‹  íŒ¨í„´ ì—°êµ¬" },
      { date: "Dec 4", activity: "ë°ì´í„°ë² ì´ìŠ¤ ìƒ¤ë”© ì „ëµ í•™ìŠµ" }
    ]
  }
];
---

<Layout title="Now... | Log8">
  <main class="min-h-screen bg-gradient-to-br from-white to-gray-50">
    <!-- Header Section -->
    <section class="bg-white border-b border-gray-200">
      <div class="container mx-auto px-8 py-12">
        <div class="text-center space-y-4">
          <h1 class="text-4xl lg:text-5xl font-bold text-gray-900">
            What I'm Doing <span class="text-green-500">Now</span>
          </h1>
          <p class="text-xl text-gray-600 max-w-2xl mx-auto leading-relaxed">
            ì§€ê¸ˆ ì´ ìˆœê°„ ì œê°€ ëª°ë‘í•˜ê³  ìˆëŠ” ê²ƒë“¤ê³¼ ì„±ì¥í•˜ê³  ìˆëŠ” ë¶„ì•¼ë“¤ì„ ê³µìœ í•©ë‹ˆë‹¤.
            ì‚´ì•„ìˆëŠ” ì§€ì  í˜¸ê¸°ì‹¬ê³¼ ê¾¸ì¤€í•œ ì‹¤í–‰ë ¥ì„ í™•ì¸í•´ë³´ì„¸ìš”.
          </p>
          <div class="flex items-center justify-center space-x-2 text-sm text-gray-500">
            <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
            <span>Live Updates</span>
          </div>
        </div>
      </div>
    </section>

    <!-- Admin Controls (only visible when logged in) -->
    <div id="admin-controls" class="hidden bg-green-50 border-b border-green-200 py-3">
      <div class="container mx-auto px-8">
        <div class="flex items-center justify-between">
          <div class="flex items-center space-x-2">
            <div class="w-3 h-3 bg-green-500 rounded-full"></div>
            <span class="text-green-700 font-medium">Admin Mode</span>
          </div>
          <div class="flex space-x-3">
            <button id="manage-content-btn" class="px-4 py-2 bg-green-500 hover:bg-green-600 text-white text-sm font-medium rounded-lg transition-colors">
              ì»¨í…ì¸  ê´€ë¦¬
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Main Content -->
    <section class="py-12">
      <div class="container mx-auto px-8">
        <div class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-8" id="now-items">
          {displayData.map((item) => (
            <div class="group bg-white rounded-2xl shadow-lg overflow-hidden hover:shadow-2xl transition-all duration-300 transform hover:-translate-y-1" data-id={item.id}>
              <!-- Card Header -->
              <div class={`bg-gradient-to-br ${item.color} p-6 relative overflow-hidden`}>
                <div class="flex items-start justify-between">
                  <div class="flex items-center space-x-3">
                    <div class="text-3xl">{item.icon}</div>
                    <div>
                      <span class={`inline-block px-3 py-1 ${item.textColor} bg-white bg-opacity-60 rounded-full text-sm font-medium`}>
                        {item.category}
                      </span>
                    </div>
                  </div>
                </div>
                <h2 class="text-2xl font-bold text-gray-900 mt-4 mb-3">{item.title}</h2>
                <p class="text-gray-700 leading-relaxed">{item.description}</p>
                <!-- Decorative elements -->
                <div class="absolute -top-4 -right-4 w-24 h-24 bg-white bg-opacity-20 rounded-full"></div>
                <div class="absolute -bottom-6 -left-6 w-32 h-32 bg-white bg-opacity-10 rounded-full"></div>
              </div>

              <!-- Timeline Section -->
              <div class="p-6">
                <div class="flex items-center space-x-2 mb-4">
                  <div class="w-4 h-4 bg-green-500 rounded-full flex items-center justify-center">
                    <div class="w-2 h-2 bg-white rounded-full"></div>
                  </div>
                  <h3 class="text-lg font-semibold text-gray-900">Recent Activities</h3>
                </div>
                
                <div class="space-y-3" data-activities={item.id}>
                  {item.activities.map((activity, index) => (
                    <div class="flex items-start space-x-3 group/activity">
                      <div class="flex-shrink-0 mt-2">
                        <div class={`w-2 h-2 rounded-full ${index === 0 ? 'bg-green-500' : 'bg-gray-300'}`}></div>
                      </div>
                      <div class="flex-1 min-w-0">
                        <div class="flex items-center space-x-2 mb-1">
                          <span class="text-sm font-medium text-gray-500">{activity.date}</span>
                        </div>
                        <p class="text-sm text-gray-700 leading-relaxed">{activity.activity}</p>
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            </div>
          ))}
        </div>
      </div>
    </section>

    <!-- Content Management Modal -->
    <div id="content-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
      <div class="bg-white rounded-xl p-6 w-full max-w-4xl mx-4 max-h-screen overflow-y-auto">
        <div class="flex justify-between items-center mb-6">
          <h2 class="text-2xl font-bold text-text">ì»¨í…ì¸  ê´€ë¦¬</h2>
          <button id="close-content-btn" class="text-error hover:text-error-light text-xl">âœ•</button>
        </div>
        
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
          <!-- ì§‘ì¤‘ ì˜ì—­ ê´€ë¦¬ -->
          <div class="border border-gray-200 rounded-lg p-6">
            <h3 class="text-lg font-semibold mb-4 text-text">ì§‘ì¤‘ ì˜ì—­ ê´€ë¦¬</h3>
            <div class="space-y-3 mb-4">
              <input type="text" id="expertise-title" placeholder="ì˜ì—­ ì œëª©" class="w-full p-2 border border-gray-300 rounded-lg">
              <textarea id="expertise-description" placeholder="ì˜ì—­ ì„¤ëª…" rows="3" class="w-full p-2 border border-gray-300 rounded-lg"></textarea>
              <input type="text" id="expertise-status" placeholder="ì§„í–‰ ìƒíƒœ (ì˜ˆ: ì§„í–‰ì¤‘, ì™„ë£Œ)" class="w-full p-2 border border-gray-300 rounded-lg">
              <button id="add-expertise-btn" class="w-full bg-accent text-text py-2 rounded-lg hover:bg-accent-light transition-colors">
                ì˜ì—­ ì¶”ê°€
              </button>
            </div>
            
            <div id="expertise-list" class="space-y-2 max-h-60 overflow-y-auto">
              <!-- ë™ì ìœ¼ë¡œ ë¡œë“œ -->
            </div>
          </div>

          <!-- í™œë™ ê´€ë¦¬ -->
          <div class="border border-gray-200 rounded-lg p-6">
            <h3 class="text-lg font-semibold mb-4 text-text">í™œë™ ê´€ë¦¬</h3>
            <div class="space-y-3 mb-4">
              <input type="text" id="activity-title" placeholder="í™œë™ ì œëª©" class="w-full p-2 border border-gray-300 rounded-lg">
              <textarea id="activity-description" placeholder="í™œë™ ì„¤ëª…" rows="3" class="w-full p-2 border border-gray-300 rounded-lg"></textarea>
              <input type="date" id="activity-date" class="w-full p-2 border border-gray-300 rounded-lg">
              <button id="add-activity-btn" class="w-full bg-accent-mint text-white py-2 rounded-lg hover:bg-accent-light transition-colors">
                í™œë™ ì¶”ê°€
              </button>
            </div>
            
            <div id="activities-list" class="space-y-2 max-h-60 overflow-y-auto">
              <!-- ë™ì ìœ¼ë¡œ ë¡œë“œ -->
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Edit Modals -->
    <!-- Edit Expertise Modal -->
    <div id="edit-expertise-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
      <div class="bg-white rounded-xl p-6 w-full max-w-md mx-4">
        <h3 class="text-lg font-semibold mb-4">ì§‘ì¤‘ ì˜ì—­ ìˆ˜ì •</h3>
        <div class="space-y-3">
          <input type="hidden" id="edit-expertise-id">
          <input type="text" id="edit-expertise-title" placeholder="ì˜ì—­ ì œëª©" class="w-full p-2 border border-gray-300 rounded-lg">
          <textarea id="edit-expertise-description" placeholder="ì˜ì—­ ì„¤ëª…" rows="3" class="w-full p-2 border border-gray-300 rounded-lg"></textarea>
          <input type="text" id="edit-expertise-status" placeholder="ì§„í–‰ ìƒíƒœ" class="w-full p-2 border border-gray-300 rounded-lg">
          <div class="flex space-x-3">
            <button id="save-expertise-btn" class="flex-1 bg-accent text-text py-2 rounded-lg hover:bg-accent-light transition-colors">
              ì €ì¥
            </button>
            <button id="cancel-expertise-btn" class="flex-1 bg-gray-300 text-gray-700 py-2 rounded-lg hover:bg-gray-400 transition-colors">
              ì·¨ì†Œ
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Edit Activity Modal -->
    <div id="edit-activity-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
      <div class="bg-white rounded-xl p-6 w-full max-w-md mx-4">
        <h3 class="text-lg font-semibold mb-4">í™œë™ ìˆ˜ì •</h3>
        <div class="space-y-3">
          <input type="hidden" id="edit-activity-id">
          <input type="text" id="edit-activity-title" placeholder="í™œë™ ì œëª©" class="w-full p-2 border border-gray-300 rounded-lg">
          <textarea id="edit-activity-description" placeholder="í™œë™ ì„¤ëª…" rows="3" class="w-full p-2 border border-gray-300 rounded-lg"></textarea>
          <input type="date" id="edit-activity-date" class="w-full p-2 border border-gray-300 rounded-lg">
          <div class="flex space-x-3">
            <button id="save-activity-btn" class="flex-1 bg-accent-mint text-white py-2 rounded-lg hover:bg-accent-light transition-colors">
              ì €ì¥
            </button>
            <button id="cancel-activity-btn" class="flex-1 bg-gray-300 text-gray-700 py-2 rounded-lg hover:bg-gray-400 transition-colors">
              ì·¨ì†Œ
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Floating Admin Button -->
    <button id="admin-toggle" class="fixed bottom-8 right-8 w-12 h-12 bg-green-500 hover:bg-green-600 text-white rounded-full shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-110 flex items-center justify-center z-40">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
      </svg>
    </button>
  </main>

  <script>
    import { supabase, getUser } from '../lib/supabase';

    interface ExpertiseItem {
      id: string;
      title: string;
      description: string;
      status: string;
    }

    interface ActivityItem {
      id: string;
      title: string;
      description: string;
      date: string;
    }

    interface NowData {
      expertise: ExpertiseItem[];
      activities: ActivityItem[];
    }

    let isAdmin = false;
    let nowData: NowData = {
      expertise: [],
      activities: []
    };

    // ê´€ë¦¬ì ê¶Œí•œ í™•ì¸
    async function checkAdminAccess() {
      try {
        const user = await getUser();
        if (user && user.email === 'sachi009955@gmail.com') {
          isAdmin = true;
          const adminControls = document.getElementById('admin-controls');
          if (adminControls) {
            adminControls.classList.remove('hidden');
          }
        }
      } catch (error) {
        console.error('ì‚¬ìš©ì í™•ì¸ ì˜¤ë¥˜:', error);
      }
    }

    // ë°ì´í„° ë¡œë“œ
    async function loadData() {
      try {
        const response = await fetch('/api/now.json');
        if (response.ok) {
          nowData = await response.json();
          renderExpertise();
          renderActivities();
        }
      } catch (error) {
        console.error('ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', error);
      }
    }

    // ì§‘ì¤‘ ì˜ì—­ ë Œë”ë§
    function renderExpertise() {
      const container = document.getElementById('expertise-list');
      if (!container) return;
      
      container.innerHTML = nowData.expertise.map(item => `
        <div class="border border-gray-200 rounded-lg p-3 flex justify-between items-start">
          <div class="flex-1">
            <h4 class="font-medium text-sm">${item.title}</h4>
            <p class="text-xs text-gray-600 mt-1">${item.description}</p>
            <span class="inline-block px-2 py-1 bg-blue-100 text-blue-700 text-xs rounded mt-2">${item.status}</span>
          </div>
          <div class="flex space-x-1 ml-2">
            <button onclick="editExpertise('${item.id}')" class="text-blue-500 hover:text-blue-700 text-xs">âœï¸</button>
            <button onclick="deleteExpertise('${item.id}')" class="text-red-500 hover:text-red-700 text-xs">ğŸ—‘ï¸</button>
          </div>
        </div>
      `).join('');
    }

    // í™œë™ ë Œë”ë§
    function renderActivities() {
      const container = document.getElementById('activities-list');
      if (!container) return;
      
      container.innerHTML = nowData.activities.map(item => `
        <div class="border border-gray-200 rounded-lg p-3 flex justify-between items-start">
          <div class="flex-1">
            <h4 class="font-medium text-sm">${item.title}</h4>
            <p class="text-xs text-gray-600 mt-1">${item.description}</p>
            <span class="text-xs text-gray-500 mt-1">${new Date(item.date).toLocaleDateString('ko-KR')}</span>
          </div>
          <div class="flex space-x-1 ml-2">
            <button onclick="editActivity('${item.id}')" class="text-blue-500 hover:text-blue-700 text-xs">âœï¸</button>
            <button onclick="deleteActivity('${item.id}')" class="text-red-500 hover:text-red-700 text-xs">ğŸ—‘ï¸</button>
          </div>
        </div>
      `).join('');
    }

    // ê´€ë¦¬ì íŒ¨ë„ í† ê¸€
    document.getElementById('admin-toggle')?.addEventListener('click', async () => {
      if (!isAdmin) {
        // Supabase ë¡œê·¸ì¸ ì‹œë„
        const { signInWithGoogle } = await import('../lib/supabase');
        await signInWithGoogle();
        return;
      }
      
      // ì´ë¯¸ ë¡œê·¸ì¸ëœ ê²½ìš° ì»¨í…ì¸  ê´€ë¦¬ ëª¨ë‹¬ ì—´ê¸°
      const contentModal = document.getElementById('content-modal');
      if (contentModal) {
        contentModal.classList.remove('hidden');
      }
    });

    document.getElementById('manage-content-btn')?.addEventListener('click', () => {
      const contentModal = document.getElementById('content-modal');
      if (contentModal) {
        contentModal.classList.remove('hidden');
      }
    });

    document.getElementById('close-content-btn')?.addEventListener('click', () => {
      const contentModal = document.getElementById('content-modal');
      if (contentModal) {
        contentModal.classList.add('hidden');
      }
    });

    // ì§‘ì¤‘ ì˜ì—­ ì¶”ê°€
    document.getElementById('add-expertise-btn')?.addEventListener('click', async () => {
      const titleInput = document.getElementById('expertise-title') as HTMLInputElement;
      const descriptionInput = document.getElementById('expertise-description') as HTMLTextAreaElement;
      const statusInput = document.getElementById('expertise-status') as HTMLInputElement;
      
      if (!titleInput || !descriptionInput || !statusInput) return;
      
      const title = titleInput.value;
      const description = descriptionInput.value;
      const status = statusInput.value;

      if (!title || !description || !status) {
        alert('ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }

      const newItem = {
        id: Date.now().toString(),
        title,
        description,
        status
      };

      nowData.expertise.push(newItem);
      await saveData();
      renderExpertise();

      // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
      titleInput.value = '';
      descriptionInput.value = '';
      statusInput.value = '';
    });

    // í™œë™ ì¶”ê°€
    document.getElementById('add-activity-btn')?.addEventListener('click', async () => {
      const titleInput = document.getElementById('activity-title') as HTMLInputElement;
      const descriptionInput = document.getElementById('activity-description') as HTMLTextAreaElement;
      const dateInput = document.getElementById('activity-date') as HTMLInputElement;
      
      if (!titleInput || !descriptionInput || !dateInput) return;
      
      const title = titleInput.value;
      const description = descriptionInput.value;
      const date = dateInput.value;

      if (!title || !description || !date) {
        alert('ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }

      const newItem = {
        id: Date.now().toString(),
        title,
        description,
        date
      };

      nowData.activities.unshift(newItem);
      await saveData();
      renderActivities();

      // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
      titleInput.value = '';
      descriptionInput.value = '';
      dateInput.value = '';
    });

    // ë°ì´í„° ì €ì¥
    async function saveData() {
      if (!isAdmin) return;
      
      try {
        const response = await fetch('/api/now.json', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(nowData)
        });

        if (!response.ok) {
          throw new Error('ì €ì¥ ì‹¤íŒ¨');
        }
      } catch (error) {
        console.error('ì €ì¥ ì˜¤ë¥˜:', error);
        alert('ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
      }
    }

    // í¸ì§‘/ì‚­ì œ í•¨ìˆ˜ë“¤
    (window as any).editExpertise = (id: string) => {
      const item = nowData.expertise.find(e => e.id === id);
      if (item) {
        const modal = document.getElementById('edit-expertise-modal');
        const idInput = document.getElementById('edit-expertise-id') as HTMLInputElement;
        const titleInput = document.getElementById('edit-expertise-title') as HTMLInputElement;
        const descriptionInput = document.getElementById('edit-expertise-description') as HTMLTextAreaElement;
        const statusInput = document.getElementById('edit-expertise-status') as HTMLInputElement;
        
        if (modal && idInput && titleInput && descriptionInput && statusInput) {
          idInput.value = id;
          titleInput.value = item.title;
          descriptionInput.value = item.description;
          statusInput.value = item.status;
          modal.classList.remove('hidden');
        }
      }
    };

    (window as any).deleteExpertise = async (id: string) => {
      if (confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        nowData.expertise = nowData.expertise.filter(e => e.id !== id);
        await saveData();
        renderExpertise();
      }
    };

    (window as any).editActivity = (id: string) => {
      const item = nowData.activities.find(a => a.id === id);
      if (item) {
        const modal = document.getElementById('edit-activity-modal');
        const idInput = document.getElementById('edit-activity-id') as HTMLInputElement;
        const titleInput = document.getElementById('edit-activity-title') as HTMLInputElement;
        const descriptionInput = document.getElementById('edit-activity-description') as HTMLTextAreaElement;
        const dateInput = document.getElementById('edit-activity-date') as HTMLInputElement;
        
        if (modal && idInput && titleInput && descriptionInput && dateInput) {
          idInput.value = id;
          titleInput.value = item.title;
          descriptionInput.value = item.description;
          dateInput.value = item.date;
          modal.classList.remove('hidden');
        }
      }
    };

    (window as any).deleteActivity = async (id: string) => {
      if (confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        nowData.activities = nowData.activities.filter(a => a.id !== id);
        await saveData();
        renderActivities();
      }
    };

    // ëª¨ë‹¬ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë“¤
    document.getElementById('save-expertise-btn')?.addEventListener('click', async () => {
      const idInput = document.getElementById('edit-expertise-id') as HTMLInputElement;
      const titleInput = document.getElementById('edit-expertise-title') as HTMLInputElement;
      const descriptionInput = document.getElementById('edit-expertise-description') as HTMLTextAreaElement;
      const statusInput = document.getElementById('edit-expertise-status') as HTMLInputElement;
      
      if (!idInput || !titleInput || !descriptionInput || !statusInput) return;
      
      const id = idInput.value;
      const title = titleInput.value;
      const description = descriptionInput.value;
      const status = statusInput.value;

      if (!title || !description || !status) {
        alert('ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }

      const item = nowData.expertise.find(e => e.id === id);
      if (item) {
        item.title = title;
        item.description = description;
        item.status = status;
        await saveData();
        renderExpertise();
        const modal = document.getElementById('edit-expertise-modal');
        if (modal) {
          modal.classList.add('hidden');
        }
      }
    });

    document.getElementById('cancel-expertise-btn')?.addEventListener('click', () => {
      const modal = document.getElementById('edit-expertise-modal');
      if (modal) {
        modal.classList.add('hidden');
      }
    });

    document.getElementById('save-activity-btn')?.addEventListener('click', async () => {
      const idInput = document.getElementById('edit-activity-id') as HTMLInputElement;
      const titleInput = document.getElementById('edit-activity-title') as HTMLInputElement;
      const descriptionInput = document.getElementById('edit-activity-description') as HTMLTextAreaElement;
      const dateInput = document.getElementById('edit-activity-date') as HTMLInputElement;
      
      if (!idInput || !titleInput || !descriptionInput || !dateInput) return;
      
      const id = idInput.value;
      const title = titleInput.value;
      const description = descriptionInput.value;
      const date = dateInput.value;

      if (!title || !description || !date) {
        alert('ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }

      const item = nowData.activities.find(a => a.id === id);
      if (item) {
        item.title = title;
        item.description = description;
        item.date = date;
        await saveData();
        renderActivities();
        const modal = document.getElementById('edit-activity-modal');
        if (modal) {
          modal.classList.add('hidden');
        }
      }
    });

    document.getElementById('cancel-activity-btn')?.addEventListener('click', () => {
      const modal = document.getElementById('edit-activity-modal');
      if (modal) {
        modal.classList.add('hidden');
      }
    });

    // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
    document.getElementById('content-modal')?.addEventListener('click', (e) => {
      if (e.target === e.currentTarget) {
        const modal = document.getElementById('content-modal');
        if (modal) {
          modal.classList.add('hidden');
        }
      }
    });

    document.getElementById('edit-expertise-modal')?.addEventListener('click', (e) => {
      if (e.target === e.currentTarget) {
        const modal = document.getElementById('edit-expertise-modal');
        if (modal) {
          modal.classList.add('hidden');
        }
      }
    });

    document.getElementById('edit-activity-modal')?.addEventListener('click', (e) => {
      if (e.target === e.currentTarget) {
        const modal = document.getElementById('edit-activity-modal');
        if (modal) {
          modal.classList.add('hidden');
        }
      }
    });

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤í–‰
    document.addEventListener('DOMContentLoaded', async () => {
      await checkAdminAccess();
      await loadData();
    });
  </script>
</Layout>