---
// Newsletter subscription form component
---

<div class="newsletter-widget bg-linear-to-r from-primary to-accent p-8 rounded-xl shadow-lg my-12">
  <div class="max-w-2xl mx-auto text-center">
    <h3 class="text-2xl font-bold text-white mb-2">ğŸ“§ ìƒˆ ê¸€ ì•Œë¦¼ ë°›ê¸°</h3>
    <p class="text-white/90 mb-6">
      ìƒˆë¡œìš´ ë¸”ë¡œê·¸ í¬ìŠ¤íŠ¸ê°€ ë°œí–‰ë˜ë©´ ì´ë©”ì¼ë¡œ ì•Œë ¤ë“œë¦½ë‹ˆë‹¤. ë¬´ë£Œì…ë‹ˆë‹¤!
    </p>

    <form id="newsletter-form" class="flex flex-col sm:flex-row gap-3">
      <input
        type="email"
        id="email-input"
        name="email"
        placeholder="your@email.com"
        required
        autocomplete="email"
        class="flex-1 px-4 py-3 rounded-lg border-0 focus:ring-2 focus:ring-white/50 outline-none text-gray-900"
      />
      <button
        type="submit"
        class="px-6 py-3 bg-white text-primary font-semibold rounded-lg hover:bg-gray-100 transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed"
      >
        êµ¬ë…í•˜ê¸°
      </button>
    </form>

    <p id="newsletter-message" class="mt-4 text-sm text-white"></p>

    <p class="mt-4 text-xs text-white/70">
      ìŠ¤íŒ¸ ë©”ì¼ì€ ì ˆëŒ€ ë³´ë‚´ì§€ ì•ŠìŠµë‹ˆë‹¤. ì–¸ì œë“  êµ¬ë…ì„ ì·¨ì†Œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    </p>
  </div>
</div>

<script>
  const form = document.getElementById("newsletter-form") as HTMLFormElement;
  const input = document.getElementById("email-input") as HTMLInputElement;
  const message = document.getElementById("newsletter-message") as HTMLParagraphElement;

  form?.addEventListener("submit", async (e) => {
    e.preventDefault();

    const email = input.value.trim();
    const button = form.querySelector("button") as HTMLButtonElement;
    const originalText = button.textContent;

    // ê¸°ë³¸ ìœ íš¨ì„± ê²€ì‚¬
    if (!email || !email.includes("@")) {
      message.textContent = "âŒ ì˜¬ë°”ë¥¸ ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.";
      message.className = "mt-4 text-sm text-red-200 font-semibold";
      return;
    }

    button.textContent = "ì²˜ë¦¬ ì¤‘...";
    button.disabled = true;
    message.textContent = "";

    try {
      const response = await fetch("/api/newsletter/subscribe", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({ email }),
      });

      const data = await response.json();

      if (response.ok) {
        message.textContent = "âœ… êµ¬ë…ë˜ì—ˆìŠµë‹ˆë‹¤! í™˜ì˜ ì´ë©”ì¼ì„ í™•ì¸í•´ì£¼ì„¸ìš”.";
        message.className = "mt-4 text-sm text-green-200 font-semibold";
        input.value = "";

        // // Google Analytics ì´ë²¤íŠ¸ (ìˆë‹¤ë©´)
        // if (typeof gtag !== "undefined") {
        //   gtag("event", "newsletter_subscribe", {
        //     event_category: "engagement",
        //     event_label: "Newsletter Subscription",
        //   });
        // }
      } else {
        message.textContent = `âŒ ì˜¤ë¥˜: ${data.error || "ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜"}`;
        message.className = "mt-4 text-sm text-red-200";
      }
    } catch (error) {
      console.error("Newsletter subscription error:", error);
      message.textContent = "âŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.";
      message.className = "mt-4 text-sm text-red-200";
    } finally {
      button.textContent = originalText;
      button.disabled = false;
    }
  });
</script>

<style>
  .newsletter-widget {
    background: linear-gradient(
      135deg,
      var(--color-primary, #485e8e) 0%,
      var(--color-accent, #00ff6a) 100%
    );
  }

  @media (max-width: 640px) {
    .newsletter-widget {
      padding: 1.5rem;
    }

    .newsletter-widget h3 {
      font-size: 1.5rem;
    }
  }
</style>
